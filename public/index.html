<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ARES - Official Website</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Stili per la schermata di caricamento */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }

        #loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid #fff;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>

<body>
    <!-- Schermata di caricamento -->
    <div id="loading-screen">
        <span class="loader"></span>
    </div>

    <div id="hero-section"></div>
    <div id="info-section"></div>

    <div class="card-container-1">
        <div class="card-container-image">
            <img src="images/characters_image.jpg" alt="Map Image" style="max-width: 100%; border-radius: 0.2rem;" />
        </div>
        <div class="card-container-description">
            <div class="title">CHARACTERS</div>
            <p style="margin-bottom: 20px;">
                Discover an incredible selection of skins designed to showcase your personality on the
                battlefield. With Ares, every style choice is
                a unique opportunity to stand out and conquer every battle with unmatched flair.
            </p>
            <button class="button-dark">
                <span class="button_text">Learn more</span>
            </button>
        </div>
    </div>

    <div class="card-container-2">
        <div class="card-container-description">
            <div class="title">MAPS</div>
            <p style="margin-bottom: 20px;">
                Discover the breathtaking universe of <strong>ARES</strong>, where realistic maps redefine the
                way battles unfold. Dive into
                stunningly detailed environments and dynamic visuals that push the boundaries of immersion and
                excitement.
            </p>
            <button class="button-dark">
                <span class="button_text">Learn more</span>
            </button>
        </div>
        <div class="card-container-image">
            <img src="images/map_image0.jpg" alt="Map Image" style="max-width: 100%; border-radius: 0.2rem;" />
        </div>
    </div>

    <div class="card-container-1">
        <div class="card-container-image">
            <img src="images/GunCustomization.jpg" alt="Map Image" style="max-width: 100%; border-radius: 0.2rem;" />
        </div>
        <div class="card-container-description">
            <div class="title">CUSTOMIZE</div>
            <p style="margin-bottom: 20px;">
                Customize your arsenal to match your playstyle. From tactical upgrades to unique designs, create
                weapons that are as powerful as
                they are personal. Your battlefield, your rules!
            </p>
            <button class="button-dark">
                <span class="button_text">Learn more</span>
            </button>
        </div>
    </div>

    <div id="dev-section"></div>
    <div id="footer-container"></div>
    <div id="popup-view"></div>

    <script defer>
        // Modifica della funzione loadComponent per tracciare il caricamento
        async function loadComponent() {
            const components = [
                { id: 'hero-section', url: 'pages/hero-section/hero-section.html' },
                { id: 'info-section', url: 'pages/info-section/info-section.html' },
                { id: 'dev-section', url: 'pages/development-section/dev-secton.html' },
                { id: 'popup-view', url: 'pages/popup/popup.html' },
                { id: 'footer-container', url: 'pages/footer/footer.html' }
            ];

            const loadingScreen = document.getElementById('loading-screen');
            let loadedComponents = 0;
            const totalComponents = components.length;

            const loadPromises = components.map(component => {
                return fetch(component.url)
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById(component.id).innerHTML = data;
                        loadedComponents++;
                        // Quando tutti i componenti sono caricati, nascondi la schermata
                        if (loadedComponents === totalComponents) {
                            loadingScreen.classList.add('hidden');
                            setTimeout(() => {
                                loadingScreen.style.display = 'none';
                            }, 500); // Attende la fine della transizione
                        }
                    })
                    .catch(error => {
                        console.error(`Error while loading ${component.id}:`, error);
                        loadedComponents++;
                        if (loadedComponents === totalComponents) {
                            loadingScreen.classList.add('hidden');
                            setTimeout(() => {
                                loadingScreen.style.display = 'none';
                            }, 500);
                        }
                    });
            });

            await Promise.all(loadPromises);
        }

        function loadScript(src) {
            const script = document.createElement('script');
            script.src = src;
            script.defer = true;
            document.body.appendChild(script);
        }

        document.addEventListener('DOMContentLoaded', loadComponent);

        document.addEventListener('DOMContentLoaded', function() {
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        if (entry.target.classList.contains('card-container-1')) {
                            entry.target.querySelector('.card-container-image').classList.add('visible-from-left');
                        } else {
                            entry.target.querySelector('.card-container-image').classList.add('visible-from-right');
                        }
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.3 });

            document.querySelectorAll('.card-container-1, .card-container-2').forEach(container => {
                observer.observe(container);
            });
        });

        function watchTrailer() {
            alert("Trailer coming soon!");
        }

        function saveContactFromPopup(event) {
            event.preventDefault();
            let emailInput = document.getElementById('popup-email');
            let nameInput = document.getElementById('popup-name');
            saveContact(nameInput, emailInput);
        }

        function saveContactFromForm(event) {
            event.preventDefault();
            let emailInput = document.getElementById('form-email');
            let nameInput = document.getElementById('form-name');
            saveContact(nameInput, emailInput);
        }

        function saveContact(nameInput, emailInput) {
            if (emailInput instanceof HTMLInputElement && nameInput instanceof HTMLInputElement) {
                let email = emailInput.value.trim();
                let name = nameInput.value.trim();

                console.log('Email:', email);
                console.log('Name:', name);

                if (email !== '' && name !== '') {
                    popupLoading();

                    let body = `email=${encodeURIComponent(email)}&name=${encodeURIComponent(name)}`;

                    fetch("https://script.google.com/macros/s/AKfycbwk2Y3NK5rzZaVB6KbOTYfcG5QUM8ir1Qk-cGv48SkjYCtVnc9WRWx2sCg3ahOu_Qbv/exec", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded"
                        },
                        body: body
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.result === "success") {
                            popupSuccess();
                            emailInput.value = '';
                            nameInput.value = '';
                        } else {
                            popupFailed();
                            console.error('Error:', data.error);
                        }
                    })
                    .catch(error => {
                        popupFailed();
                        console.error('Error:', error);
                    });
                } else {
                    alert('Please enter both a valid name and email.');
                }
            }
        }

        function popupLoading() {
            let emailInput = document.getElementById('popup-email');
            let nameInput = document.getElementById('popup-name');
            let loader = document.getElementById('loader-bar');
            let submitButton = document.getElementById('submitButton');

            emailInput.style.display = 'none';
            nameInput.style.display = 'none';
            loader.style.display = 'block';
            submitButton.style.display = 'none';
        }

        function popupSuccess() {
            let popup = document.getElementById('popup');
            let popupSuccess = document.getElementById('popup-success');
            popup.style.display = 'none';
            popupSuccess.style.display = 'block';
        }

        function popupFailed() {
            let popup = document.getElementById('popup');
            let popupFailed = document.getElementById('popup-failed');
            popup.style.display = 'none';
            popupFailed.style.display = 'block';
        }

        function openPopup() {
            popupReset();
            document.body.classList.add('popup-active');
            document.querySelector('.popup-view').classList.add('active');
        }

        function closePopup() {
            document.body.classList.remove('popup-active');
            document.querySelector('.popup-view').classList.remove('active');
        }

        function popupReset() {
            let popup = document.getElementById('popup');
            let popupSuccess = document.getElementById('popup-success');
            let popupFailed = document.getElementById('popup-failed');
            let emailInput = document.getElementById('popup-email');
            let nameInput = document.getElementById('popup-name');
            let loader = document.getElementById('loader-bar');
            let submitButton = document.getElementById('submitButton');

            popup.style.display = 'block';
            popupSuccess.style.display = 'none';
            popupFailed.style.display = 'none';
            emailInput.style.display = 'block';
            nameInput.style.display = 'block';
            loader.style.display = 'none';
            submitButton.style.display = 'block';
        }
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="pages/popup/popup.css">
</head>
<body>
<div class="popup-view">
    <form class="popup" id="popup">
        <button type="button" class="exitBtn" onclick="closePopup()">×</button>
        <div class="popup-heading">BETA ACCESS.</div>
        <p class="popup-subheading">By entering your email, you will be added to the queue for the Ares test. We will send you an email with instructions on how to try the game.</p>
        <div class="inputContainer">
            <input class="textfield" placeholder="Enter your name" type="text" name="name" id="popup-name" />
            <input class="textfield" placeholder="Enter your email" type="email" name="email" id="popup-email" />
            <button type="submit" class="button-light" id="submitButton" onclick="submitEmail(event)">
                <span class="button_text">
                    SIGN UP
                </span>
            </button>
        </div>
        <!-- Area di caricamento -->
        <div id="loader-bar" class="loader" style="display: none;">
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="shadow"></div>
            <div class="shadow"></div>
            <div class="shadow"></div>
        </div>
    </form>
    <div id="popup-success" class="popup-message" style="display: none;">
        <button type="button" class="exitBtn" onclick="closePopup()">×</button>
        <div class="title" style="color: hsl(163, 87%, 44%);">
            SUCCESS
        </div>
        <div class="subtitle">You will receive an email with further instructions.</div>
    </div>
    <div id="popup-failed" class="popup-message" style="display: none;">
        <button type="button" class="exitBtn" onclick="closePopup()">×</button>
        <div class="title" style="color: hsl(0, 87%, 44%);">
            ERROR
        </div>
        <div class="subtitle">You will receive an email with further instructions.</div>
    </div>

</div>
    <script>
        function submitEmail(event) {
            event.preventDefault();

            console.log('submitEmail function called');

            let emailInput = document.getElementById('popup-email');
            let nameInput = document.getElementById('popup-name');

            if (emailInput instanceof HTMLInputElement && nameInput instanceof HTMLInputElement) {
                let email = emailInput.value.trim();
                let name = nameInput.value.trim();

                console.log('Email:', email);
                console.log('Name:', name);

                if (email !== '' && name !== '') {
                    popupLoading();

                    let body = `email=${encodeURIComponent(email)}&name=${encodeURIComponent(name)}`;

                    fetch("https://script.google.com/macros/s/AKfycbwk2Y3NK5rzZaVB6KbOTYfcG5QUM8ir1Qk-cGv48SkjYCtVnc9WRWx2sCg3ahOu_Qbv/exec", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded"
                        },
                        body: body
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.result === "success") {
                            popupSuccess();
                            emailInput.value = '';
                            nameInput.value = '';
                        } else {
                            popupFailed();
                            console.error('Error:', data.error);
                        }
                    })
                    .catch(error => {
                        popupFailed();
                        console.error('Error:', error);
                    });
                } else {
                    alert('Please enter both a valid name and email.');
                }
            }
        }

        function popupLoading() {
            let emailInput = document.getElementById('popup-email');
            let nameInput = document.getElementById('popup-name');
            let loader = document.getElementById('loader-bar');
            let submitButton = document.getElementById('submitButton');

            emailInput.style.display = 'none'
            nameInput.style.display = 'none'
            loader.style.display = 'block';
            submitButton.style.display = 'none';  
        }

        function popupSuccess() {
            let popup = document.getElementById('popup');
            let popupSuccess = document.getElementById('popup-success');

            popup.style.display = 'none';
            popupSuccess.style.display = 'block'
        }

        function popupFailed() {
            let popup = document.getElementById('popup');
            let popupFailed = document.getElementById('popup-failed');

            popup.style.display = 'none';
            popupFailed.style.display = 'block'
        }
    </script>
</body>